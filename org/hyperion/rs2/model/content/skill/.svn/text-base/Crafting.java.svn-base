package org.hyperion.rs2.model.content.skill;

import java.io.FileNotFoundException;
import org.hyperion.rs2.model.content.*;
import org.hyperion.rs2.model.Player;
import org.hyperion.rs2.model.World;
import org.hyperion.rs2.event.*;


/**
 * Handles crafting
 * @author Jonas(++)
 * @author madturnip - martin
 *
 */

public class Crafting implements ContentTemplate {
	
	public Crafting(){}

	private final int GEM_ANIM = 2269,
		CRAFT_ANIM = 2269;
		
	public final int[] uncuts = {1623,1621,1619,1617,1631,1625,1627,1629,};
	public final int[] cut = {1607,1605,1603,1601,1615,1609,1611,1613,};
	public final int[] cutLevel = {1,20,30,40,60,20,25,30,};
	public final int[] cutXp = {100,150,160,170,200,120,130,140};

	public boolean attemptCut(Player c,int useItem,int slot1,int onItem,int slot2){
		if(onItem == 1755){
			onItem = useItem;
			useItem = 1755;
		}
		if(onItem == 1733){
			onItem = useItem;
			useItem = 1733;
		}
		if(useItem == 1755)
			return cutGem(c,onItem);
		else if(useItem == 1733)
			return craftLeather(c,onItem);
		return false;
	}
	
	public int getGem(int i){
		for(int k = 0; k < uncuts.length; k++){
			if(uncuts[k] == i)
				return k;
		}
		return -1;
	}
	
	public boolean cutGem(Player c, int gem) {
		int g = getGem(gem);
		if(g == -1){
			ContentEntity.sendMessage(c,"You cannot cut this item.");
			return true;
		}
		String name = ContentEntity.getItemName(gem);
		
		// Check if the player can cut the gem.
		if(ContentEntity.returnSkillLevel(c,12) < cutLevel[g]) {
			ContentEntity.sendMessage(c,"Your Crafting level is not high enough to craft this.");
			return true;
		}
		
		ContentEntity.startAnimation(c,GEM_ANIM);	
		
		ContentEntity.sendMessage(c,"You cut the "+name+".");
		
		ContentEntity.addItem(c,cut[g], 1);
		
		ContentEntity.deleteItem(c,uncuts[g], 1);
		
		ContentEntity.addSkillXP(c,cutXp[g], 12);
		
		return true;
	}
	
	/**
	 * Crafting any kind of leather with a needle.
	 * @param c The {@link Player}.
	 * @param item The leather.
	 */
	
	public boolean craftLeather(final Player c, final int item) {
		try {
			int l = getLeather(item);
			if(l == -1){
				ContentEntity.sendMessage(c,"You cannot craft this item");
				return true;
			}
			if(ContentEntity.returnSkillLevel(c,12) < leatherLevel[l]) {
				ContentEntity.sendMessage(c,"Your Crafting level is not high enough to craft this.");
				return true;
			}
			c.getExtraData().put("craftingItem",l);
			int[] items = finishItem[l];
			int index = 0;
			for(int k : frameId[items.length]){
				if(index == 0){
					ContentEntity.sendString(c,"What do you want to make?", k);
				} else if(index >= (items.length*2+1)){
					c.getActionSender().sendPacket164(k);
				} else if(index >= (items.length+1)){
					ContentEntity.sendInterfaceModel(c,k,250,items[(index-items.length-1)]);
				} else {
					ContentEntity.sendString(c,ContentEntity.getItemName(items[index-1]),k);
				}
				index++;
			}
			return true;
		/*
		sendFrame126("What do you want to make?", 8879);
		sendFrame246(8870, 250, longbows[id]); // right picture
		sendFrame246(8869, 250, shortbows[id]); // left picture
			sendFrame126(getItemName(shortbows[id]), 8871);
			sendFrame126(getItemName(shortbows[id]), 8874);
			sendFrame126(getItemName(longbows[id]), 8878);
			sendFrame126(getItemName(longbows[id]), 8875);
		sendFrame164(8866);*/
		
		/*
		sendString("What would you like to make?", 8898);
		sendString("Vambraces", 8889);
		sendString("Chaps", 8893);
		sendString("Body", 8897);
		sendFrame246(8883, 250, gloves[i]);
		sendFrame246(8884, 250, legs[i]);
		sendFrame246(8885, 250, chests[i]);
		sendFrame164(8880);
		*/
		} catch (Exception e){
			e.printStackTrace();
		}
		return false;
	}
	
	public boolean startAgain(final Player c,final int amm,final int slot){
		if(((Integer) c.getExtraData().get("craftingItem")) == -1){
			System.out.println("problem");
			return false;
		}
		c.getExtraData().put("craftingMade",finishItem[((Integer) c.getExtraData().get("craftingItem"))][slot]);
		finishCraft(c,amm);
		return true;
	}
	
	public void finishCraft(final Player c,final int amm){
		if(c == null)
			return;
		if(((Integer) c.getExtraData().get("craftingItem")) == -1 || ((Integer) c.getExtraData().get("craftingMade")) == -1 || amm <= 0)
			return;
		World.getWorld().submit(new Event(2000) {
			int craftAm = amm;
			@Override
			public void execute() {
				if(craftAm <= 0){
					stop2();
					return;
				} else if(ContentEntity.getItemAmount(c,(leatherItem[((Integer) c.getExtraData().get("craftingItem"))]+1)) > 0 && ContentEntity.getItemAmount(c,1735) > 0){
					ContentEntity.startAnimation(c,CRAFT_ANIM);	
					ContentEntity.sendMessage(c,"You craft the leather.");
					ContentEntity.deleteItem(c,leatherItem[((Integer) c.getExtraData().get("craftingItem"))], 1);
					ContentEntity.deleteItem(c,1734, 1);
					ContentEntity.addItem(c,((Integer) c.getExtraData().get("craftingMade")), 1);
					ContentEntity.addSkillXP(c,leatherXp[((Integer) c.getExtraData().get("craftingItem"))], 12);
					craftAm--;
				} else {
					stop2();
					return;
				}
			}

			
			public void stop2() {
				c.getExtraData().put("craftingItem",-1);
				c.getExtraData().put("craftingMade",-1);
				this.stop();
			}
			
		});
	}
	
	public int getLeather(int i){
		for(int k = 0; k < leatherItem.length; k++){
			if(leatherItem[k] == i)
				return k;
		}
		return -1;
	}
	public final int[][] frameId = {
											{},//0 items we dont use this
											{},//1 items
											{},//2 items
											{8898,8889,8893,8897,8883,8884,8885,8880},//3 items
											{},//4 Item
										};
	public final int[] leatherItem = {1741,1743,1745,2505,2507,2509};
	public final int[][] finishItem = {
												{1061,1063,1095,1129,},
												{1131,},
												{1065,1099,1135,},
												{2487,2493,2499},
												{2489,2495,2501},
												{2491,2497,2503},
											};
	public final int[] leatherXp = {100,120,150,160,170,180};
	public final int[] leatherLevel = {1,15,40,50,60,70};
	
	@Override
	public int[] getValues(int type){
		return null;
	}
	
	@Override
	public boolean clickObject(final Player client,final int type,final int id,final int slot,final int itemId2,final int itemSlot2){
		return false;
	}
	
	@Override
	public void init() throws FileNotFoundException {
	}	
	
	// needle: 1733
	// chisel: 1755
	/* 1059 Leather gloves 
 1061 Leather boots 
 1063 Leather vambraces 
 1095 Leather chaps 
 1129 Leather body 
 1131 Hardleather body 
 1167 Leather cowl 
 1741 Leather 
 1743 Hard leather 
 1745 Green d-leather 
 2505 Blue d-leather 
 2507 Red dragon leather 
 2509 Black d-leather 
*/

}